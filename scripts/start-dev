#!/bin/bash -e

DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

. $(dirname "$0")/log

COMPOSE_PROJECT_NAME="npmdev"
COMPOSE_FILE="docker/docker-compose.dev.yml"
export COMPOSE_FILE COMPOSE_PROJECT_NAME

# Ensure docker-compose exists
if hash docker-compose 2>/dev/null; then
	cd "${DIR}/.."
	log "Starting Dev Stack ..." "info"

	docker-compose up -d --remove-orphans --force-recreate --build

	echo ""
	log "Admin UI:     http://127.0.0.1:3081" "success"
	log "Nginx:        http://127.0.0.1:3080" "success"
	log "Swagger Doc:  http://127.0.0.1:300" "success"
	echo ""

	if [ "$1" == "-f" ]; then
		log "Following Backend Container:" "warning"
		docker logs -f npmdev_npm_1
	else
		log "You can follow the output of some of the containers with:\n  docker logs -f npmdev_npm_1" "hint"
	fi
else
	log "docker-compose command is not available" "danger"
fi
