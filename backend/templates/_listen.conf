{% if enable_proxy_protocol == 1 or enable_proxy_protocol == true -%}
{% assign port_number_http = "88" -%}
{% assign port_number_https = "444" -%}
{% assign listen_extra_args = "proxy_protocol" -%}
{% else -%}
{% assign port_number_http = "80" -%}
{% assign port_number_https = "443" -%}
{% assign listen_extra_args = "" -%}
{% endif -%}

  listen {{ port_number_http }} {{ listen_extra_args }};
{% if ipv6 -%}
  listen [::]:{{ port_number_http }} {{ listen_extra_args }};
{% endif -%}

{% if certificate -%}
  {% capture listen_extra_args_https %}ssl{% if http2_support %} http2{% endif %} {{ listen_extra_args }}{% endcapture -%}
  listen {{ port_number_https }} {{ listen_extra_args_https }};
{% if ipv6 -%}
  listen [::]:{{ port_number_https }} {{ listen_extra_args_https }};
{% endif -%}
{% endif -%}

  server_name {{ domain_names | join: " " }};
